
 Product: WSO2 ESB Connector for Bitly API + Integration Tests

 Pre-requisites:

  - Maven 3.x
  - Java 1.6 or above

 Tested Platform: 

  - UBUNTU 12.04
  - WSO2 ESB 4.8.1

 STEPS:
 
 1. To build the connector without running tests from any location, run maven build with the -Dmaven.test.skip=true switch.

 2. Add the WSO2 ESB 4.8.1 to the {basedir}/test folder.
    If you want to use another location, please change it accordigly in the pom.xml as follows.

           <carbon.zip>
          	 ${basedir}/../repository/wso2esb-${esb.version}.zip
           </carbon.zip>
	
	(Make sure the ESB 4.8.1 zip file with latest patches available at "Integration_Test/products/esb/4.8.1/modules/distribution/target/")

 3. import the certificate to the esb client keystore as follows,

	i) Go to "https://api-ssl.bitly.com/v3/user/info?access_token=AcessToken" in your browser, and then click the HTTPS trust icon on the address bar (e.g., the padlock next to the URL in Firefox).

	ii) View the certificate details (the steps vary by browser) and then export the trust certificate to the file system.

	iii) Use the ESB Management Console or the following command to import that certificate into the ESB client keystore.

	   ( keytool -importcert -file <certificate file> -keystore <ESB>/repository/resources/security/client-truststore.jks -alias "BitlyTrustCertImport" )

	IV) Restart the server and deploy the Bitly configuration

	V) Also import certificate into the keystores files(client-truststore.jks & wso2carbon.jks) in the test module.
	
	   (src/test/resources/keystores/products and src/test/resources/keystores/stratos) 

 4. Before attempting to run integration tests, uncomment the following in pom.xml:

	i)<parent>
        	<groupId>org.wso2.esb</groupId>
        	<artifactId>esb-integration-tests</artifactId>
        	<version>4.8.1</version>
        	<relativePath>../pom.xml</relativePath>
    	   </parent>

	ii) <dependency>
            	<groupId>org.wso2.esb</groupId>
            	<artifactId>org.wso2.connector.integration.test.base</artifactId>
            	<version>4.8.1</version>
           	 <scope>system</scope>
           	 <systemPath>${basedir}/repository/org.wso2.connector.integration.test.base-4.8.1.jar</systemPath>
       	   </dependency>



 4. Make sure the bitly test suite is enabled (as given below) and all other test suites are commented in the "testng.xml" file - "bitly/src/test/resources/testng.xml" 

	 <test name="Bitly-Connector-Test" preserve-order="true" verbose="2">
		<packages>
		    <package name="org.wso2.carbon.connector.integration.test.bitly"/>
		</packages>
    	</test>

 5. Create a Bitly account using the URL "https://bitly.com/" and store the generic access-token you get after successfully registering the application.

 6. Update the bitly.properties file with your details if you have any or you can use the default account details as it is.

    	accessTokenNegative=b2c707e30a1219a7bf0d2adead244dd
	clientId=6813e06e166cc731c44b00e40e1d9053324b9abe
	clientSecret=b761f2a933cddd619155700296679d01b677b508	

 9. Navigate to "${basedir}" and run the following command.
     $ mvn clean install


 10. NOTE : Following developer account can be used for run the integration tests.
 	Username : 
 	Password : 
